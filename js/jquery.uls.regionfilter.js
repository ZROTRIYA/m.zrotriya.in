(function($){'use strict';var RegionSelector;RegionSelector=function(element,options){this.$element=$(element);this.options=$.extend({},$.fn.regionselector.defaults,options);this.$element.addClass('regionselector');this.regions=[];this.cache=null;this.regionGroup=this.$element.data('regiongroup');this.init();this.listen();};RegionSelector.prototype={constructor:RegionSelector,init:function(){var region=this.$element.data('region');this.regions=$.uls.data.getRegionsInGroup(this.regionGroup);if(region){this.regions.push(region);}},test:function(langCode){var region,i,langRegions=$.uls.data.getRegions(langCode);for(i=0;i<this.regions.length;i++){region=this.regions[i];if($.inArray(region,langRegions)>=0){this.render(langCode,region);this.cache[langCode]=region;return;}}},show:function(){var result,languagesByScriptGroup,scriptGroup,languages,i,$element=this.options.$target&&this.options.$target.$element,$parent=$element&&$element.parent(),$prev=$element&&$element.prev();if($element&&$parent){$element.detach();}if(this.cache){result=null;for(result in this.cache){this.render(result,this.cache[result]);}}else{this.cache={};languagesByScriptGroup=$.uls.data.getLanguagesByScriptGroup(this.options.languages);for(scriptGroup in $.uls.data.scriptgroups){languages=languagesByScriptGroup[scriptGroup];if(!languages){continue;}languages.sort($.uls.data.sortByAutonym);for(i=0;i<languages.length;i++){this.test(languages[i]);}}}if($element&&$parent){if($prev){$prev.after($element);}else{$parent.append($element);}}if(this.options.success){this.options.success(this);}},render:function(langCode,region){var $target=this.options.$target;if(!$target){return;}$target.append(langCode,region);},listen:function(){this.$element.on('click',$.proxy(this.click,this));},click:function(){if(this.$element.hasClass('active')){return;}this.options.$target.empty();this.show();$('.regionselector').removeClass('active');if(this.regionGroup){this.$element.addClass('active');}}};$.fn.regionselector=function(option){return this.each(function(){var $this=$(this),data=$this.data('regionselector'),options=typeof option==='object'&&option;if(!data){$this.data('regionselector',(data=new RegionSelector(this,options)));}if(typeof option==='string'){data[option]();}});};$.fn.regionselector.defaults={$target:null,success:null,noresults:null,languages:null};$.fn.regionselector.Constructor=RegionSelector;}(jQuery));