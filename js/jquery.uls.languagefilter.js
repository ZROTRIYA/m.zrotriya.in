(function($){'use strict';var LanguageFilter,delay;LanguageFilter=function(element,options){this.$element=$(element);this.options=$.extend({},$.fn.regionselector.defaults,options);this.$element.addClass('languagefilter');this.resultCount=0;this.$suggestion=this.$element.parents().find('#'+this.$element.data('suggestion'));this.$clear=this.$element.parents().find('#'+this.$element.data('clear'));this.selectedLanguage=null;this.listen();};delay=(function(){var timer=0;return function(callback,milliseconds){clearTimeout(timer);timer=setTimeout(callback,milliseconds);};}());LanguageFilter.prototype={listen:function(){this.$element.on('keypress',$.proxy(this.keyup,this)).on('keyup',$.proxy(this.keyup,this));if(this.eventSupported('keydown')){this.$element.on('keydown',$.proxy(this.keyup,this));}if(this.$clear.length){this.$clear.on('click',$.proxy(this.clear,this));}this.toggleClear();},keyup:function(e){var suggestion,query,languageFilter;switch(e.keyCode){case 9:suggestion=this.$suggestion.val();if(suggestion&&suggestion!==this.$element.val()){this.$element.val(suggestion);e.preventDefault();e.stopPropagation();}break;case 13:if(!this.options.onSelect){break;}e.preventDefault();e.stopPropagation();query=$.trim(this.$element.val()).toLowerCase();if(this.selectedLanguage){this.options.onSelect(this.selectedLanguage);}else if(this.options.languages[query]){this.options.onSelect(query);}break;default:languageFilter=this;if(e.which<32&&e.which!==8){break;}this.selectedLanguage=null;delay(function(){if(!languageFilter.$element.val()){languageFilter.clear();}else{languageFilter.options.$target.empty();languageFilter.search();}},300);this.toggleClear();}},deactivate:function(){this.$element.val('');if(!$.fn.uls.Constructor.prototype.isMobile()){this.$element.focus();}this.toggleClear();this.autofill();},clear:function(){this.deactivate();this.$element.trigger('searchclear');},toggleClear:function(){if(!this.$clear.length){return;}if(this.$element.val()){this.$clear.show();}else{this.$clear.hide();}},search:function(){var languagesInScript,query=$.trim(this.$element.val()),languages=$.uls.data.getLanguagesByScriptGroup(this.options.languages),scriptGroup,langNum,langCode;this.resultCount=0;for(scriptGroup in languages){languagesInScript=languages[scriptGroup];languagesInScript.sort($.uls.data.sortByAutonym);for(langNum=0;langNum<languagesInScript.length;langNum++){langCode=languagesInScript[langNum];if(query===''||this.filter(langCode,query)){if(this.resultCount===0){this.autofill(langCode);}if(query.toLowerCase()===langCode){this.selectedLanguage=langCode;}this.render(langCode);this.resultCount++;}}}if(!this.resultCount&&this.options.searchAPI&&query){this.searchAPI(query);}else{this.resultHandler(query);}},searchAPI:function(query){var languageFilter=this;$.get(languageFilter.options.searchAPI,{search:query},function(result){$.each(result.languagesearch,function(code,name){if(languageFilter.resultCount===0){languageFilter.autofill(code,name);}languageFilter.render(code);languageFilter.resultCount++;});languageFilter.resultHandler(query);});},resultHandler:function(query){if(this.resultCount===0&&this.options.noresults){this.$suggestion.val('');this.options.noresults.call(this,query);}else if(this.options.success){this.options.success(this,query,this.resultCount);}},autofill:function(langCode,languageName){if(!this.$suggestion.length){return;}if(!this.$element.val()){this.$suggestion.val('');return;}this.selectedLanguage=langCode;languageName=languageName||this.options.languages[langCode];if(!languageName){return;}var autonym,userInput=this.$element.val(),suggestion=userInput+languageName.substring(userInput.length,languageName.length);if(suggestion.toLowerCase()!==languageName.toLowerCase()){autonym=$.uls.data.getAutonym(langCode)||'';suggestion=userInput+autonym.substring(userInput.length,autonym.length);if(suggestion!==autonym){suggestion='';}}if(!isVisualPrefix(userInput,suggestion)){suggestion='';}this.$suggestion.val(suggestion);},render:function(langCode){var $target=this.options.$target;if(!$target){return;}$target.append(langCode,null);},escapeRegex:function(value){return value.replace(/[\-\[\]{}()*+?.,\\\^$\|#\s]/g,'\\$&');},filter:function(langCode,searchTerm){var matcher=new RegExp('^'+this.escapeRegex(searchTerm),'i'),languageName=this.options.languages[langCode];return matcher.test(languageName)||matcher.test($.uls.data.getAutonym(langCode))||matcher.test(langCode)||matcher.test($.uls.data.getScript(langCode));},eventSupported:function(eventName){var isSupported=eventName in this.$element;if(!isSupported){this.$element.setAttribute(eventName,'return;');isSupported=typeof this.$element[eventName]==='function';}return isSupported;}};$.fn.languagefilter=function(option){return this.each(function(){var $this=$(this),data=$this.data('languagefilter'),options=typeof option==='object'&&option;if(!data){$this.data('languagefilter',(data=new LanguageFilter(this,options)));}if(typeof option==='string'){data[option]();}});};$.fn.languagefilter.defaults={$target:null,searchAPI:null,languages:null,noresults:null,success:null,onSelect:null};$.fn.languagefilter.Constructor=LanguageFilter;function isVisualPrefix(prefix,string){var prebases='െേൈൊോൌெேைொோௌେୈୋୌિਿिিেৈোৌෙේෛොෝෞ';return prebases.indexOf(string[prefix.length])<=0;}}(jQuery));